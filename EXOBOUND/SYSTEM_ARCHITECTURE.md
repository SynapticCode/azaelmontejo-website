# EXOBOUND System Architecture

## Overview

EXOBOUND is a jsPsych + Phaser-based experimental game that simulates tactical fleet command with a continuous allocation mechanic. The system is designed to preserve experimental validity while providing a rich narrative experience.

## Main Components

- **experiment.js**: Entry point, sets up jsPsych timeline and launches Phaser game for each trial.
- **GameDataManager.js**: Manages all trial data, campaign structure, fleet/alien state, and narrative context.
- **GlobalSettings.js**: Stores persistent settings.
- **NarrativeEngine.js**: Maps experimental variables to narrative context and generates story content.
- **Scenes (Phaser)**:
  - **BootScene.js**: Loads assets and sets up the game.
  - **GameScene.js**: Main gameplay logic, object creation, and scene transitions.
  - **HUDScene.js**: UI overlay for allocation, info panels, and dialogue.
  - **FeedbackSceneV2.js**: Shows results, feedback, and battle animations.
  - **TutorialUIScene.js**: Handles step-by-step onboarding and tutorial dialogue.
  - **InstructionScene.js**, **BriefingScene.js**, **WaveOutcomeScene.js**: Handle instructions, briefings, and wave summaries.
- **Components/Feedback**: Modular feedback and animation components used by scenes.
- **js/dialogues/**: Contains global dialogue arrays for narrative content.

## Control Flow

1. `experiment.js` initializes jsPsych and launches a Phaser game for each trial.
2. `GameDataManager` sets up trial data and campaign structure.
3. `GameScene` is created:
   - If tutorial: launches `TutorialUIScene`.
   - Else: launches `HUDScene`.
4. Player interacts (allocation, fire, etc.).
5. On action, `FeedbackSceneV2` is launched to show results.
6. On continue, scenes are reset for the next trial.

## Data Flow

- Trial data is generated by `GameDataManager` and passed between scenes via the Phaser registry.
- Player actions are captured in `HUDScene` and results are displayed in `FeedbackSceneV2`.
- Narrative context is generated per trial by `NarrativeEngine` or loaded from global arrays.

## Dependencies

- **Phaser**: Game engine for rendering, scene management, and input.
- **jsPsych**: Manages experiment timeline, data collection, and trial sequencing.
- **Global Variables**: Used for dialogue arrays and some settings.
- **Component System**: Feedback and animation components are imported and used by scenes.

## Extensibility

- The dialogue system is modular and can be expanded for all trials and waves.
- NarrativeEngine can be extended for more dynamic or personalized storytelling.
- All experimental variables and data structures are preserved for statistical analysis. 